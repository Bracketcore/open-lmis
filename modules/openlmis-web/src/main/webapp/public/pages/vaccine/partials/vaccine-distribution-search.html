<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright © 2013 VillageReach
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~  
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org. 
  -->

<div xmlns="http://www.w3.org/1999/html">
    <h2><span openlmis-message="label.search.distribution.batch"></span>
        <a href="#/create-distribution-batch" class="pull-right btn btn-primary"><span id="distribution-add-new"
                                                                         openlmis-message="button.add.new"></span></a>
    </h2>

    <form ng-submit="saveVaccineTarget()" id="create-vaccineTarget" name="vaccineTargetForm" novalidate>
        <div class="app-form">
            <div class="form-group">
                <h3 >Demographics/Targets</h3>
                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label for="geographicZone" >Health Facility<span class="label-required"> *</span></label>
                        <div class="form-field">

                            <input id="searchDistribution" class="search-query input-xxlarge" type="text" ng-model="query"
                                   on-keyup="showUserSearchResults()" openlmis-message="placeholder.user.search"/>

                        <span class="field-error" ng-show="vaccineTargetForm.geographicZone.$error.required && showError"
                              openlmis-message="missing.value">

                        </span>
                        </div>
                    </div>

                    <div class="form-cell">
                        <label for="year" >Year<span class="label-required"> *</span></label>
                        <div class="form-field">
                            <input type="button" openlmis-message="search"/>
                        <span class="field-error" ng-show="vaccineTargetForm.targetYear.$error.required && showError"
                              openlmis-message="missing.value">

                        </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <h3 openlmis-message="label.basicInformation"></h3>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label for="firstName" openlmis-message="create.user.firstName"><span class="label-required">
                         *</span></label>

                        <div class="form-field">
                            <input ng-model="user.firstName" name="firstName" id="firstName" type="text" maxlength="50"
                                   ng-required="true"/>
                            <span class="field-error" ng-show="userForm.firstName.$error.required && showError"
                                  openlmis-message="missing.value">
                            </span>
                        </div>
                    </div>


                    <div class="form-cell">
                        <label for="lastName" openlmis-message="create.user.lastName"><span class="label-required"> *</span></label>

                        <div class="form-field">
                            <input ng-model="user.lastName" name="lastName" id="lastName" type="text" maxlength="50"
                                   ng-required="true"/>
                            <span class="field-error" ng-show="userForm.lastName.$error.required && showError"
                                  openlmis-message="missing.value">
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label for="email" openlmis-message="create.user.email"><span class="label-required"> *</span></label>

                        <div class="form-field">
                            <input ng-model="user.email" name="email" id="email" type="text" maxlength="50" ng-required="true"/>
                            <span class="field-error" ng-show="userForm.email.$error.required && showError"
                                  openlmis-message="missing.value">
                            </span>
                        </div>
                    </div>
                    <div class="form-cell">
                        <label for="jobTitle" openlmis-message="create.user.jobTitle"> </label>

                        <div class="form-field">
                            <input ng-model="user.jobTitle" id="jobTitle" type="text" maxlength="50"/>
                        </div>
                    </div>
                </div>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label for="officePhone" openlmis-message="create.user.officePhone"> </label>

                        <div class="form-field">
                            <input ng-model="user.officePhone" id="officePhone" type="text" maxlength="30"/>
                        </div>
                    </div>


                    <div class="form-cell">
                        <label for="cellPhone" openlmis-message="create.user.cellPhone"> </label>

                        <div class="form-field">
                            <input ng-model="user.cellPhone" id="cellPhone" type="text" maxlength="30"/>
                        </div>
                    </div>
                </div>

            </div>
            <div class="form-group">
                <h3 openlmis-message="label.dashboard.preference"></h3>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label class="labels" openlmis-message="label.program"></label>
                        <div class="form-fields">
                            <select ui-select2 style="width:240px;" class="large-input" name="program"  ng-model="preference.program" ng-change="filterProductsByProgram()">
                                <option ng-repeat="option in programs" value="{{option.id}}">{{option.name}}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label class="labels" openlmis-message="label.facility"></label>

                        <div class="form-field">
                            <select ui-select2 id="facility-name" style="width:240px;" name="facility" ng-model="preference.facility"  required="true">
                                <option  ng-repeat="option in allFacilities" value="{{ option.id }}">{{ option.code }} - {{ option.name }}</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row clearfix">
                    <div class="form-cell">
                        <label class="labels" openlmis-message="label.product"><span class="label-required">*</span></label>

                        <div class="form-field">
                            <select ui-select2="productSelectOption" style="width:240px;" name="product" class="input-sm"  ng-model="preference.products" ng-change="processProductsFilter()" openlmis-message="placeholder.select.product"
                                    multiple="multiple" >
                                <option  ng-repeat="option in products" value="{{ option.id }}">{{ option.name }}</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </form>


    <div class="alert alert-success" id="saveSuccessMsgDiv" ng-show="userId">
        <span ng-bind="message"></span>.&nbsp;<a id="viewHereLink" href="" ng-click="editUser(userId)"
                                                 openlmis-message="search.viewHere"></a>
    </div>

    <!--<input id="searchDistribution" class="search-query input-xxlarge" type="text" ng-model="query"
           on-keyup="showUserSearchResults()" openlmis-message="placeholder.user.search"/>
-->
    <div class="form-tip" openlmis-message="search.threeCharacters"></div>
<!--
    <div class="facility-list" ng-show="query.length > 2">
        <div ng-switch on="resultCount">
            <h3 ng-switch-when="0" openlmis-message="msg.no.matches|query"></h3>

            <h3 ng-switch-when="1" openlmis-message="msg.one.match|query"></h3>

            <h3 ng-switch-default openlmis-message="msg.many.matches|resultCount|query"></h3>
        </div>
        <a class="close-btn" href="" ng-click="clearSearch()" tabindex="-1"></a>
        <ul id="userList" class="user-list" ng-model="filteredUsers">
            <li ng-repeat="user in filteredUsers" ng-class="{'user-disabled': !user.active}">
                <a id="user{{$index}}" href="" ng-click="editUser(user.id)">
                    <span class="user-name">{{user.firstName}} {{user.lastName}}</span>
                    <span class="user-username">({{user.userName}})</span> -
                    {{user.email}}
                </a>

                <div class="user-actions">
                    <a href="/public/pages/admin/sms/index.html#/create-sms/{{user.id}}" class="btn btn-primary btn-small">SMS</a>

                    <a id="editUser{{$index}}" href="" class="btn btn-primary btn-small" openlmis-message="button.edit"
                       ng-click="editUser(user.id)"></a>
                    <a id="resetPassword{{$index}}" href="" class="btn btn-primary btn-small"
                       ng-class="{'disabled': !user.active}" openlmis-message="button.reset.password"
                       ng-click="changePassword(user)"></a>
                    <a href="/public/pages/admin/user/preference/index.html#/edit-user-preference/{{user.id}}" class="btn btn-primary btn-small" openlmis-message="button.edit.user.preference"></a>
                </div>
            </li>
        </ul>
    </div>-->

    <div >
        <table class="table table-striped table-bordered">
            <thead>
            <tr  class="gradient-header">
                <th>Batch Number</th>
                <th>From</th>
                <th>To</th>
                <th>Production Date</th>
                <th>Expiry Date</th>
                <th>Donor</th>
                <th>Product</th>
                <th>Received Date</th>
                <th>Quantity</th>
                <th>Unusable</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="distribuion in distributionBatches">
                <td>{{ distribuion.batchNumber }}</td>
                <td>{{ distribuion.fromFacility.name }}</td>
                <td>{{ distribuion.toFacility.name }}</td>
                <td>{{ distribuion.productionDate }}</td>
                <td>{{ distribuion.expiryDate }}</td>
                <td>{{ distribuion.donor.name }}</td>
                <td>{{ distribuion.product.name }}</td>
                <td>{{ distribuion.receivedDate }}</td>
                <td>{{ distribuion.quantity }}</td>
                <td>{{ distribuion.unusable }}</td>
                <td class="user-actions">
                    <a href="/public/pages/admin/sms/index.html#/create-sms/{{user.id}}" class="btn btn-primary btn-small" openlmis-message="button.receive"></a>
                    <a href="" class="btn btn-primary btn-small" openlmis-message="button.edit"
                       ng-click="editDistributionBatch(distribution.id)"></a>
                    <a href="/public/pages/admin/user/preference/index.html#/edit-user-preference/{{user.id}}" class="btn btn-primary btn-small" openlmis-message="button.delete"></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div id="changePassword" modal="changePasswordModal" options="{'backdrop':'static', 'escape':false}">
        <form name="passwordForm">
            <div class="modal-header">
                <h3>
                    <span openlmis-message="message.reset.password"></span>&nbsp;<span ng-bind="user.firstName"></span>&nbsp;
                    <span ng-bind="user.lastName"></span>
                </h3>
            </div>

            <div class="alert alert-error" ng-bind="error" ng-show="error"></div>
        </form>
    </div>

    <div class="modal-footer">
        <input id="resetPasswordDone" type="button" class="btn btn-primary" openlmis-message="button.done"
               ng-click="updatePassword()"
               ng-hide="message"/>
        <input id="resetPasswordCancel" type="button" class="btn btn-cancel" openlmis-message="button.cancel"
               ng-click="resetPasswordModal()"
               ng-hide="message"/>
        <input id="resetPasswordOk" type="button" class="btn btn-primary" openlmis-message="button.ok"
               ng-click="resetPasswordModal()"
               ng-show="message"/>
    </div>

    </form>
</div>

</div>