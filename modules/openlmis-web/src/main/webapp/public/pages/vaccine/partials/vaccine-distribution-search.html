
<!--
~ This program is part of the OpenLMIS logistics management information system platform software.
~ Copyright © 2013 VillageReach
~
~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
~  
~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org. 
-->

<div class="init-rnr">
    <h2 openlmis-message="label.initiate.receive.vaccine"></h2>
    <div class="alert alert-success" id="saveSuccessMsgDiv" ng-show="inventoryTransactionId">
        <span ng-bind="message"></span>.&nbsp;<!--<a id="viewHereLink" href="" ng-click="editDistributionBatch(distributionBatchId)"
                                                 openlmis-message="search.viewHere"></a>-->
    </div>

    <br>

    <div class="row-fluid">
        <div class="span12">
            <label openlmis-message="label.requisition.facilityType"></label>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2 form-inline">
            <input id="myFacility" type="radio" ng-model="selectedType"
                   value="0" ng-checked="selectedType==0"
                   ng-change="loadFacilityData(selectedType);"/>
            &nbsp;<label for="myFacility"><strong
                openlmis-message="label.myFacility"></strong></label>
        </div>
        <div class="span4 form-inline">
            <input id="supervisedFacilityRnr" type="radio"
                   ng-model="selectedType" value="1"
                   ng-checked="selectedType==1"
                   ng-change="loadFacilityData(selectedType);"/>
            &nbsp;<label for="supervisedFacilityRnr"><strong
                openlmis-message="label.supervised.Facility"></strong></label>
        </div>
    </div>

    <br>

    <div ng-show="selectedType == 0">
        <div class="row-fluid">
            <div class="span12">
                <label openlmis-message="label.requisition.facilityName"></label>
            </div>
        </div>
        <div class="row-fluid">
            <input type="text" class="span3" ng-model="facilityDisplayName"
                   readonly="readonly"/>
        </div>
    </div>


    <div ng-show="selectedType == 1">
        <div class="row-fluid">
            <div class="span12">
                <label openlmis-message="label.requisition.facilityName"></label>
            </div>
        </div>
        <div class="row-fluid">
            <select placeholder="{{ facilityOptionMessage() }}"
                    class="span3" id="facilityList"
                    ng-model="selectedFacilityId">
                <option value=""></option>
                <option ng-repeat="facility in facilities | limitTo:50 | orderBy : 'name'"
                        value="{{ facility.id }}">{{ facility.code }} - {{
                    facility.name }}
                </option>
            </select>
        </div>

    </div>
    <a style="margin-bottom: 5px;" href="#/create-distribution-batch/{{selectedFacilityId}}" class="pull-right btn btn-primary"><span id="distribution-batch-add-new"
                                                                                   openlmis-message="button.add.receive.new"></span></a>

    <table class="table table-striped table-bordered">
            <thead>
            <tr  class="gradient-header">
                <th>Batch Number</th>
                <th>From</th>
                <th>To</th>
                <th>Production Date</th>
                <th>Expiry Date</th>
                <th>Donor</th>
                <th>Product</th>
                <th>Received Date</th>
                <th>Quantity</th>
                <th>Unusable</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-click="rowClickedEvent(distribution)" style="cursor: pointer" ng-repeat="distribution in distributionBatches">
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.batchId }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.fromFacility.name }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.toFacility.name }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ convertStringToCorrectDateFormat(distribution.stringProductionDate)}}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ convertStringToCorrectDateFormat(distribution.stringExpiryDate) }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.donor.shortName }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.product.primaryName }} {{distribution.product.strength}}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ convertStringToCorrectDateFormat(distribution.stringReceiveDate) }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.quantity }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">{{ distribution.unusable }}</td>
                <td ng-class="{'highlight' : selected == distribution.id}">
                    <a href="" ng-click="addReceive(distribution)" class="btn btn-primary btn-small" openlmis-message="button.receive"></a>
                    <a href="" class="btn btn-primary btn-small" openlmis-message="button.edit"
                       ng-click="editDistributionBatch(distribution.id)"></a>
                    <a href="/public/pages/admin/user/preference/index.html#/edit-user-preference/{{user.id}}" class="btn btn-primary btn-small" openlmis-message="button.delete"></a>
                </td>
            </tr>
            </tbody>
        </table>

</div>