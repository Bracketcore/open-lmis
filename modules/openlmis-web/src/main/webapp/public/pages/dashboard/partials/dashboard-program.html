<!DOCTYPE html>

<!--
  ~ Electronic Logistics Management Information System (eLMIS) is a supply chain management system for health commodities in a developing country setting.
  ~
  ~ Copyright (C) 2015  John Snow, Inc (JSI). This program was produced for the U.S. Agency for International Development (USAID). It was prepared under the USAID | DELIVER PROJECT, Task Order 4.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<script id="template/accordion/accordion.html" type="text/ng-template">
    <div class="accordion" ng-transclude></div>
</script>

<script id="template/accordion/accordion-group.html" type="text/ng-template">
    <div class="accordion-group">
        <div class="accordion-heading" style="margin-bottom:0; border-bottom:0">
           <a style="bottom:0" class="accordion-toggle" ng-class="{'collapsed':!isOpen,'open':isOpen}" ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a>
        </div>
        <div class="accordion-body" style="display:block; margin-bottom:0" collapse="!isOpen">

            <div class="accordion-inner" ng-transclude></div>  </div>
    </div>
</script>


<script type="text/ng-template" id="product-summary">
    <div style="width: 600px;">
        <div class="triangle"></div>
        <div class="ns-popover-tooltip">

            <tabset class="table">
                <tab>
                    <tab-heading style="cursor: pointer;"><span openlmis-message="title.overview"></span></tab-heading>
                    <table style="width: 100%;">
                        <thead>
                        <tr class="gradient-header">
                            <th openlmis-message="label.items"></th>
                            <th openlmis-message="label.this.period"></th>
                            <th openlmis-message="label.last.period"></th>
                        </tr>

                        </thead>
                        <tr ng-repeat="item in productSummary">
                            <td>{{item.label}}</td>
                            <td>{{item.this_period}}</td>
                            <td>{{item.last_period}}</td>
                        </tr>
                    </table>

                </tab>
                <tab>
                    <tab-heading style="cursor: pointer;"><span openlmis-message="title.legend"></span></tab-heading>
                    <table class="table">
                        <thead>
                        <tr class="gradient-header">
                            <th openlmis-message="title.legend"></th>
                            <th openlmis-message="title.definition"></th>
                        </tr>
                        </thead>
                        <tr ng-repeat="def in definitions">
                            <td>{{def.label}}</td>
                            <td>{{def.definition}}</td>
                        </tr>
                    </table>

                </tab>
            </tabset>

        </div>
    </div>

</script>

<script type="text/ng-template" id="facilities-stock-out">
    <div style="width: 600px;">
        <div class="triangle"></div>
        <div class="ns-popover-tooltip" style="max-height: 300px; overflow-y: scroll;">
            <table style="width: 100%; " class="table">
                <thead>
                <tr class="gradient-header">
                    <th openlmis-message="label.facility" rowspan="2"></th>
                    <th openlmis-message="label.stock.on.hand" colspan="2"></th>
                </tr>
                <tr class="gradient-header">
                    <th openlmis-message="label.this.period"></th>
                    <th openlmis-message="label.last.period"></th>
                </tr>

                </thead>
                <tbody>
                <tr ng-repeat="facility in facilities">
                    <td>{{facility.facility_name}}</td>
                    <td>{{facility.stock_in_hand}}</td>
                    <td>{{facility.previous_stock_in_hand}}</td>
                </tr>
                </tbody>

            </table>

        </div>
    </div>

</script>

<div xmlns="http://www.w3.org/1999/html">

    <ng-include src="'/public/pages/dashboard/shared/dashboard-header_new.html'"></ng-include>

    <div class="row">
        <div class="span2" style="border-right: solid 1px #EAEFF3">
            <div>
                <div ng-repeat="trend in productsTrend">
                    <div style="padding: 10px 30px; border-bottom: solid 1px #EAEFF3">
                        <div style="text-align: center" ns-popover ng-click="getProductSummary(trend.code)"
                             ns-popover-template="product-summary"
                             ns-popover-trigger="click"
                             ns-popover-theme="ns-popover-tooltip-theme"
                             ns-popover-timeout="1000"
                             ns-popover-placement="{{adjustPlacement($index)}}"
                             ns-popover-hide-on-inside-click="false"
                             ns-popover-hide-on-outside-click="true"
                             ns-popover-hide-on-button-click="true" style="cursor: pointer; padding: 10px 0px;">
                            {{trend.name}}
                        </div>
                        <spark-line af-data="trend.sohTrend" af-option="sparkOption"></spark-line>
                        <div style="margin-top:5px; text-align: center">
                            <div ns-popover ng-click="getFacilitiesStockedOut(trend.code)"
                                 ns-popover-template="facilities-stock-out"
                                 ns-popover-trigger="click"
                                 ns-popover-theme="ns-popover-tooltip-theme"
                                 ns-popover-timeout="1000"
                                 ns-popover-placement="{{adjustPlacement($index)}}"
                                 ns-popover-hide-on-inside-click="false"
                                 ns-popover-hide-on-outside-click="true"
                                 ns-popover-hide-on-button-click="true" style="cursor: pointer; padding: 10px 0px;">
                                <span ng-class="trend.color"
                                      style="  color:white; padding:2px 20px; border-radius:10px; font-size:12px;">{{trend.facilityStockedOut | number}}</span>
                            </div>

                        </div>


                    </div>

                </div>
            </div>
        </div>
        <div class="span10"></div>
    </div>

</div>
<div id="flotTip"></div>