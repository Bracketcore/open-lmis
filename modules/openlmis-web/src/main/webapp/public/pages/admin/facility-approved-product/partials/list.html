<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright Â© 2013 VillageReach
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org.
  -->

<div xmlns="http://www.w3.org/1999/html">
  <h2 id="facilityApprovedProducts" openlmis-message="header.facility.approved.products"></h2>

  <div class="row-fluid">
    <div class="span12">
      <label openlmis-message="label.program"></label>
    </div>
  </div>
  <div class="row-fluid section-divider">
    <select ui-select2 class="select2-container bottom-spacer span3" name="programs" id="programs"
            ng-model="program" ng-change="loadProducts(1)"
            ng-options="pgm as pgm.name for pgm in programs">
      <option value="" openlmis-message="label.select.program"></option>
    </select>
  </div>

  <div class="row-fluid">
    <div class="span12">
      <label openlmis-message="label.facility.type"></label>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span12">
      <select ui-select2 class="select2-container bottom-spacer span3" name="facilityType" id="facilityType"
              ng-model="facilityType" ng-change="loadProducts(1)"
              ng-options="ft as ft.name for ft in facilityTypes">
        <option value="" openlmis-message="create.facility.select.facilityType"></option>
      </select>
    </div>
  </div>

  <em openlmis-message="msg.please.select.program.facility.type" ng-hide="showResults"></em>

  <h2 ng-show="showResults">
    <span id="searchSupplyLineLabel" openlmis-message="label.search.products"></span>
    <a href="#/create" class="pull-right btn btn-primary">
      <span id="supplyLineAddNew" openlmis-message="button.add.new"></span>
    </a>
  </h2>

  <!--<div class="alert alert-success" id="saveSuccessMsgDiv" ng-show="facilityApprovedProductId">-->
  <!--<span id="successMessage" ng-bind="message"></span>.&nbsp;&nbsp;-->
  <!--<a id="viewHereLink" href="" ng-click="edit(facilityApprovedProductId)" openlmis-message="search.viewHere"></a>-->
  <!--</div>-->

  <div id="searchControl" class="row-fluid" ng-show="showResults">
    <div class="span5 search-in-category">
      <div class="input-append input-prepend">
        <div class="btn-group">
        </div>
        <input id='searchFacilityApprovedProduct' type="text" class="span5" ng-model="query" maxlength="50"
               openlmis-message="msg.enter.product.code.name"
               ng-keydown="triggerSearch($event)"/>
        <button class="btn" ng-click="loadProducts(1)">
          <i id='searchIcon' class="icon-search"></i>
        </button>

        <button id="clearProductSearch" class="btn" ng-click="clearSearch()" ng-disabled="!query"
                openlmis-message="label.clear.search"></button>
      </div>
    </div>
  </div>

  <table id="facilityApprovedProductTable" class="table table-bordered search-list" ng-show="showResults">
    <thead>
    <tr class="gradient-header resultCountHeader">
      <th colspan="10">
        <span ng-switch on="totalItems" ng-show="searchedQuery">
          <h3 id="noResultMessage" ng-switch-when="0" openlmis-message="msg.no.matches|searchedQuery"></h3>
          <h3 id="oneResultMessage" ng-switch-when="1" openlmis-message="msg.one.match|searchedQuery"></h3>
          <h3 id="nResultsMessage" ng-switch-default openlmis-message="msg.many.matches|totalItems|searchedQuery"></h3>
        </span>

        <h3 id="noRecordsMessage" ng-show="!searchedQuery && totalItems === 0"
            openlmis-message="msg.no.records.found"></h3>

        <h3 id="nRecordsMessage" ng-show="!searchedQuery && totalItems"
            openlmis-message="msg.records.found|totalItems"></h3>
      </th>
    </tr>
    <tr class="gradient-header" ng-show="facilityApprovedProducts.length">
      <th id="fullSupply" openlmis-message="header.full.supply"></th>
      <th id="code" openlmis-message="header.code"></th>
      <th id="name" openlmis-message="header.name"></th>
      <th id="strength" openlmis-message="header.strength"></th>
      <th id="unitOfMeasure" openlmis-message="header.unit.of.measure"></th>
      <th id="maxMonthStocks" openlmis-message="header.max.months.of.stock"></th>
      <th id="minMonthStocks" openlmis-message="header.min.months.of.stock"></th>
      <th id="eop" openlmis-message="label.emergency.order.point"></th>
      <th id="globalActive" openlmis-message="header.global.active"></th>
      <th id="activeAtProgram" openlmis-message="header.active.at.program"></th>
    </tr>
    </thead>
    <tbody ng-repeat="facilityApprovedProduct in facilityApprovedProducts">
    <tr>
      <td class="productCategory" colspan="10"
          ng-show="showCategory($index)"
          ng-bind="facilityApprovedProduct.programProduct.productCategory.name"></td>
    </tr>
    <tr>
    <td class="center-justified">
        <i id="fullSupply{{$index}}"
           ng-class="{'icon-ok': facilityApprovedProduct.programProduct.product.fullSupply}"></i>
      </td>
      <td ng-bind="facilityApprovedProduct.programProduct.product.code"></td>
      <td ng-bind="facilityApprovedProduct.programProduct.product.primaryName"></td>
      <td ng-bind="facilityApprovedProduct.programProduct.product.strength"></td>
      <td ng-bind="facilityApprovedProduct.programProduct.product.dosageUnit.code"></td>
      <td class="right-justified" ng-bind="facilityApprovedProduct.maxMonthsOfStock"></td>
      <td class="right-justified" ng-bind="facilityApprovedProduct.minMonthsOfStock"></td>
      <td class="right-justified" ng-bind="facilityApprovedProduct.eop"></td>
      <td class="center-justified">
        <i id="GlobalActive{{$index}}"
           ng-class="{'icon-ok': facilityApprovedProduct.programProduct.product.active}"></i>
      </td>
      <td class="center-justified">
        <i id="activeAtProgram{{$index}}"
           ng-class="{'icon-ok': facilityApprovedProduct.programProduct.active}"></i>
      </td>
    </tr>
    </tbody>
  </table>

  <pagination total-items="totalItems" page="currentPage" max-size="5" items-per-page="pagination.limit"
              direction-links="false" ng-show="facilityApprovedProducts.length" class="pagination-sm"></pagination>
</div>