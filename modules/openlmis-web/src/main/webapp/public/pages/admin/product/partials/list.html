<!--
  ~ Copyright Â© 2013 VillageReach.  All Rights Reserved.  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  ~
  ~ If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
  -->

<h2><span>{{title}}</span>
    <a href="#" id="product-add-new"
       class="pull-right btn btn-primary"
       ng-disable="newProductMode"
       ng-click="startAddNewProduct()">Add New</a></h2>

<div class="alert alert-success" id="saveSuccessMsgDiv" ng-bind="message" ng-show="message"/>
<div class="box-content" ng-hide="newProductMode">

        <form ng-submit="" name="filterForm" novalidate>
            <div class="clearfix ">
                <div class="form-cell horizontalFilters">
                    <label class="labels">Program</label>

                    <div class="form-fields">
                        <select ui-select2 style="width:200px;" class="large-input" name="program" id="program"
                                ng-change="showProductsSearchResults('program')"
                                ng-model="program" ng-options="option.id as option.name for option in programs">
                            <option style="display:none" value="">All Programs</option>

                        </select>
                    </div>
                </div>

            </div>
        </form>
</div>
<!-- Add Product -->
<form ng-submit="createProduct()" id="createProductForm" name="createProductForm"
      ng-show="newProductMode"
      novalidate select2-blur>

<div ng-class="app-form">
<div ng-class="formActive">
<div class="form-group">
<h3>Basic Information</h3>

<div class="form-row clearfix">
<div class="form-cell">
    <label for="code">Code<span
            class="label-required"> *</span></label>

    <div class="form-field" style="width: 40%;">

        <input ng-model="product.code" name="code" id="code" type="text"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.code.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Pack Size-->
<div class="form-cell">
    <label for="packSize">Pack Size<span
            class="label-required"> *</span></label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="packSize" name="packSize" id="packSize" type="text"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.packSize.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- product name-->
<div class="form-cell">
    <label for="primaryName">Product Name<span
            class="label-required"> *</span></label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.primaryName" name="primaryName" id="primaryName" type="text"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.primaryName.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Dispensing Units-->
<div class="form-cell">
    <label for="dispensingUnit">Dispensing Unit<span
            class="label-required"> *</span></label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.dispensingUnit" name="dispensingUnit" id="dispensingUnit"
               type="text"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.dispensingUnit.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>

    </div>
</div>


<!-- product strength-->
<div class="form-cell">
    <label for="strength">Strength</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.strength" name="strength" id="strength" type="text"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.strength.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Type-->
<div class="form-cell">
    <label for="type">Type</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.type" name="type" id="type" type="text"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.type.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Dosage Units-->
<div class="form-cell">
    <label for="dosageUnit">DosageUnit</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="dosageUnit" id="dosageUnit" ng-model="product.dosageUnits.id"
                ng-options="option.id as option.name for option in dosageUnits">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.dosageUnit.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Display Order-->
<div class="form-cell">
    <label for="displayOrder">Display Order</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.displayOrder" name="displayOrder" id="displayOrder" type="text"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.displayOrder.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Form-->
<div class="form-cell">
    <label for="formid">Product Form</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="formid" id="formid" ng-model="product.formid"
                ng-options="option.id as option.name for option in productForms">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.productForm.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Product Categories-->
<div class="form-cell">
    <label for="categoryid">Category</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="categoryid" id="categoryid" ng-model="product.productCategory"
                ng-options="option.id as option.name for option in productCategories">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.productDisplayOrder.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Thresh hold-->
<div class="form-cell">
    <label for="packRoundingThreshold">Threshold<span
            class="label-required"> *</span></label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.packRoundingThreshold" name="packRoundingThreshold" id="packRoundingThreshold"
               type="text"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.packRoundingThreshold.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<div class="form-cell"></div>


<!-- Product Full Supply-->
<div class="form-cell" style="margin-left: 30px;">
    <div class="form-field" style="width: 40%;">
        <table>
            <tr>
                <td><input ng-model="product.fullSupply" name="fullSupply" id="fullSupply"
                           type="checkbox"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Full Supply</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.tracer" name="tracer" id="tracer" type="checkbox"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Tracer</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.active" name="active" id="active" type="checkbox" ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Active</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.roundToZero" name="roundToZero" id="roundToZero" type="checkbox"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Round to Zero</td>
            </tr>


        </table>
    </div>
</div>


</div>
</div>
<!--basic information-->

<div class="form-group">
    <h3>Program Association</h3>

    <table border="0">
        <th></th>
        <th colspan="2">Program</th>
        <th>Price</th>
        <tr ng-repeat="program in programs" tab-scroll>
            <td style="width: 200px;">&nbsp;</td>
            <td><span class="span1" openlmis-message="program.name"></span></td>
            <td><span class="span1"><input id="program{{program.id}}" type="checkbox" ng-checked="contains(program.id)"
                                           ng-model="checked"/></span></td>
            <td><span class="span1"><input id="price{{program.id}}" type="text"/></span></td>
        </tr>
    </table>
</div>
<!--program association-->
<div class="row-fluid product-button-row">
    <div class="span1"></div>
    <div class="span2">
        <input type="submit" class="btn btn-primary btn-small" openlmis-message="button.create"/>
        <input type="button" class="btn btn-cancel btn-small" openlmis-message="button.cancel"
               ng-click="cancelAddNewProduct()"/>
    </div>
    <div ng-show="creationError" class="span9 form-error" ng-bind="creationError"></div>
</div>

</div>
</div>
</form>




<!-- Edit Product -->

<form class="edit-product-form" id="editProductForm" name="editProductForm"
      ng-submit="updateProduct(product, editProductForm);"
      ng-show="products && (products.length > 0)" novalidate select2-blur>
      <input type="hidden" ng-model="backupProductRow"/>
      <div ng-class="productsBackupMap[product.id].editFormActive">
      <div class="row-fluid list-row" ng-show="productsBackupMap[product.id].edit">

<div ng-class="app-form">
<div class="form-group">
<h3>Basic Information</h3>

<div class="form-row clearfix">
<div class="form-cell">
    <label for="code">Code
        <span ng-show="productsBackupMap[product.id].edit" class="label-required">*</span>
    </label>


    <div class="form-field" style="width: 40%;">

        <input ng-model="product.code" name="code" id="code_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.code.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Pack Size-->
<div class="form-cell">
    <label for="packSize">Pack Size
        <span ng-show="productsBackupMap[product.id].edit" class="label-required">*</span>
    </label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.packSize" name="packSize" id="packSize_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.packSize.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- product name-->
<div class="form-cell">
    <label for="primaryName">Product Name
        <span ng-show="productsBackupMap[product.id].edit" class="label-required">*</span>
    </label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.primaryName" name="primaryName" id="primaryName_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.primaryName.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Dispensing Units-->
<div class="form-cell">
    <label for="dispensingUnit">Dispensing Unit
        <span ng-show="productsBackupMap[product.id].edit" class="label-required">*</span>
    </label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.dispensingUnit" name="dispensingUnit" id="dispensingUnit_{{$index}}"
               type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.dispensingUnit.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>

    </div>
</div>


<!-- product strength-->
<div class="form-cell">
    <label for="strength">Strength</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.strength" name="strength" id="strength_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.strength.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Type-->
<div class="form-cell">
    <label for="type">Type</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.type" name="type" id="type_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.type.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Dosage Units-->
<div class="form-cell">
    <label for="dosageUnit">DosageUnit</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="dosageUnit" id="dosageUnit_{{$index}}"
                ng-show="productsBackupMap[product.id].edit"
                ng-model="product.dosageUnits.id"
                ng-options="option.id as option.name for option in dosageUnits">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.dosageUnit.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Display Order-->
<div class="form-cell">
    <label for="displayOrder">Display Order</label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.displayOrder" name="displayOrder" id="displayOrder_{{$index}}" type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.displayOrder.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<!-- Product Form-->
<div class="form-cell">
    <label for="formid">Product Form</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="formid" id="formid_{{$index}}"
                ng-model="product.formid"
                ng-show="productsBackupMap[product.id].edit"
                ng-options="option.id as option.name for option in productForms">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.productForm.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Product Categories-->
<div class="form-cell">
    <label for="categoryid">Category</label>

    <div class="form-field" style="width: 40%;">

        <select ui-select2 style="width:200px;" name="categoryid" id="categoryid_{{$index}}"
                ng-show="productsBackupMap[product.id].edit"
                ng-model="product.productCategory"
                ng-options="option.id as option.name for option in productCategories">

        </select>
                                       <span class="field-error"
                                             ng-show="createProductForm.productDisplayOrder.$error.required && showErrorForCreate"
                                             openlmis-message="missing.value">
                                        </span>
    </div>
</div>


<!-- Thresh hold-->
<div class="form-cell">
    <label for="packRoundingThreshold">Threshold
        <span ng-show="productsBackupMap[product.id].edit" class="label-required">*</span>
    </label>

    <div class="form-field" style="width: 40%;">
        <input ng-model="product.packRoundingThreshold" name="packRoundingThreshold" id="packRoundingThreshold_{{$index}}"
               type="text"
               ng-show="productsBackupMap[product.id].edit"
               maxlength="20"
               ng-required="true"/>
                                        <span class="field-error"
                                              ng-show="createProductForm.packRoundingThreshold.$error.required && showErrorForCreate"
                                              openlmis-message="missing.value">
                                        </span>
    </div>
</div>

<div class="form-cell"></div>


<!-- Product Full Supply-->
<div class="form-cell" style="margin-left: 30px;">
    <div class="form-field" style="width: 40%;">
        <table>
            <tr>
                <td><input ng-model="product.fullSupply" name="fullSupply" id="fullSupply_{{$index}}"
                           type="checkbox"
                           ng-show="productsBackupMap[product.id].edit"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Full Supply</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.tracer" name="tracer" id="tracer_{{$index}}" type="checkbox"
                           ng-show="productsBackupMap[product.id].edit"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Tracer</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.active" name="active" id="active_{{$index}}" type="checkbox"
                           ng-show="productsBackupMap[product.id].edit"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Active</td>
            </tr>
            <tr>
                <td>
                    <input ng-model="product.roundToZero" name="roundToZero" id="roundToZero_{{$index}}" type="checkbox"
                           ng-show="productsBackupMap[product.id].edit"
                           ng-required="false"/>
                </td>
                <td>&nbsp;</td>
                </td>
                <td>Round to Zero</td>
            </tr>


        </table>
    </div>
</div>


</div>
</div>
<!--basic information-->

<div class="form-group">
    <h3>Program Association</h3>

    <table border="0">
        <th></th>
        <th colspan="2">Program</th>
        <th>Price</th>
        <tr ng-repeat="program in programs" tab-scroll>
            <td style="width: 200px;">&nbsp;</td>
            <td><span class="span1" openlmis-message="program.name"></span></td>
            <td><span class="span1"><input id="program{{program.id}}__{{$index}}" type="checkbox" ng-checked="contains(program.id)"
                                           ng-model="checked"/></span></td>
            <td><span class="span1"><input id="price{{program.id}}__{{$index}}" type="text"/></span></td>
        </tr>
    </table>
</div>
</div>
</div>


<!--program association-->
<div class="row-fluid product-button-row" ng-show="productsBackupMap[product.id].edit">
    <div class="span1"></div>
    <div class="span2">
        <input type="submit" class="btn btn-primary btn-small" openlmis-message="button.create"/>
        <input type="button" class="btn btn-cancel btn-small" openlmis-message="button.cancel"
               ng-click="cancelAddNewProduct()"/>
    </div>
    <div ng-show="creationError" class="span9 form-error" ng-bind="creationError"></div>
</div>

</div>

</form>

<!---->

<div ng-hide="newProductMode">
    <!-- column headers-->
    <div class="list-header-container">
    <div class="row-fluid list-header">
        <div class="span1" style="float: left; width: 40px;"></div>
        <div class="span1" style="float: left; width: 40px;"></div>
        <div class="span1">Code</div>
        <div class="span3">Name</div>
        <div class="span1">Program</div>
        <div class="span1">Strength</div>
        <div class="span2">Unit of Measure</div>
        <div class="span1">Active</div>
        <div class="span1">Full Supply</div>

    </div>
   </div>
    <div class="list-container">
    <!--repeat-->
    <div ng-repeat="pr in filteredProducts | orderBy:'-fullName':true" class="row-fluid list-row">
        <div class="span1" style="float: left; width: 40px;">
            <!-- Edit button-->
            <input type="button"
                   class="btn btn-mini pull-right"
                   value="Edit"
                   ng-click="startProductEdit(pr, backupProductRow); productsBackupMap[pr.id].edit=true;"/>
        </div>
        <!-- Delete button-->
        <div class="span1" style="float: left; width: 40px;">
            <input type="button"
                   class="btn btn-mini pull-right"
                   value="Delete"
                   ng-show="pr.active==true"
                   ng-click="showConfirmProductDeleteWindow(pr); productsBackupMap[pr.id].deleted=true;"/>

            <input type="button"
                   class="btn btn-mini pull-right"
                   value="Restore"
                   ng-show="pr.active==false"
                   ng-click="showConfirmProductRestoreWindow(pr); productsBackupMap[pr.id].restore=true;"/>

        </div>


        <!-- Code-->
        <div class="span1" style="overflow: visible;"> {{pr.code}}</div>
        <!-- name-->
        <div class="span3" style="..."> {{pr.fullName}}</div>
        <!-- Program-->
        <div class="span1" style="..."> {{pr.programName}}</div>
        <!-- Strenght-->
        <div class="span1" style="overflow: visible;"> {{pr.strength}}</div>
        <!-- UOM-->
        <div class="span2" style="..."> {{pr.dispensingUnit}}</div>
        <!-- Active-->
        <div class="span1" style="..."> {{YesNo(pr.active)}}</div>
        <!-- Active-->
        <div class="span1" style="..."> {{YesNo(pr.fullSupply)}}</div>


        <!--list-->                     </div>
    <!--list-->    </div>
</div>






