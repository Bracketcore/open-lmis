<!--
  ~ This program is part of the OpenLMIS logistics management information system platform software.
  ~ Copyright Â© 2013 VillageReach
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see http://www.gnu.org/licenses.  For additional information contact info@OpenLMIS.org.
  -->
<div ng-controller="CreateFacilityApprovedProductController">
  <div id="facilityApprovedProductsModal" modal="facilityApprovedProductsModal"
       options="{ backdrop: 'static', escape: false}">
    <div class="modal-header">
      <h3 openlmis-message="label.add.facility.approved.products|program.name|facilityType.name"></h3>
    </div>

    <div class="modal-body">
      <div class="row-fluid">
        <div class="span7">
          <label for="productCategory" openlmis-message="label.category"></label>
          <select ui-select2 class="span11 bottom-spacer" id="productCategory"
                  ng-model="productCategorySelected" name="productCategory"
                  openlmis-message="placeholder.select.category"
                  ng-options="category.name for category in productCategories | orderBy: 'name'"
                  ng-change="filterProductsByCategory();">
            <option></option>
          </select>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span11">
          <label for="product" openlmis-message="label.product.code"></label>
          <select ui-select2="{formatResult: formatResult, formatSelection: formatSelection}"
                  class="span11 bottom-spacer"
                  id="product"
                  ng-model="productSelected" name="product"
                  openlmis-message="placeholder.select.product">
            <option></option>
            <option value="header" class="option-header" disabled="disabled" ng-show="products.length"> Product Code |
              Product Name | Strength | Units of Measure | Type
            </option>
            <option value={{product}} ng-repeat="product in products | orderBy: ['primaryName','code']">
              {{product.code}} | {{product.primaryName}} | {{product.strength}} | {{product.dosageUnit.code}} |
              {{product.fullSupply}}
            </option>
          </select>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span3">
          <label for="facilityTypeApprovedProduct.maxMonthsOfStock">
            <span openlmis-message="header.max.months.of.stock"></span>
            <span class="label-required">*</span>
          </label>
          <input type="text" class="span12 right-justified" name="maxMonthsOfStock"
                 ng-model="newFacilityTypeApprovedProduct.maxMonthsOfStock"
                 id="facilityTypeApprovedProduct.maxMonthsOfStock"
                 numeric-validator="positiveNumericValue,2,2" ng-trim="false" maxlength="5"/><br>
            <span class="rnr-form-error" style="display:none;" id="maxMonthsOfStock"
                  openlmis-message="error.number.only">
            </span>
        </div>

        <div class="span3">
          <label for="facilityTypeApprovedProduct.minMonthsOfStock"
                 openlmis-message="header.min.months.of.stock"></label>
          <input type="text" class="span12 right-justified" name="minMonthsOfStock"
                 ng-model="newFacilityTypeApprovedProduct.minMonthsOfStock"
                 id="facilityTypeApprovedProduct.minMonthsOfStock"
                 numeric-validator="positiveNumericValue,2,2" ng-trim="false" maxlength="5"/><br>
            <span class="rnr-form-error" style="display:none;" id="minMonthsOfStock"
                  openlmis-message="error.number.only">
            </span>
        </div>

        <div class="span3">
          <label for="facilityTypeApprovedProduct.eop" openlmis-message="label.emergency.order.point"></label>
          <input type="text" class="span12 right-justified" name="emergencyOrderPoint"
                 ng-model="newFacilityTypeApprovedProduct.eop"
                 id="facilityTypeApprovedProduct.eop"
                 numeric-validator="positiveNumericValue,2,2" ng-trim="false" maxlength="5"/><br>
            <span class="rnr-form-error" style="display:none;" id="emergencyOrderPoint"
                  openlmis-message="error.number.only">
            </span>
        </div>

        <div class="span2">
          <label>&nbsp;</label>
          <input type="button" href="" id="addFacilityTypeApprovedProduct" class="btn btn-primary"
                 ng-click="addFacilityTypeApprovedProduct()"
                 ng-disabled="isAddDisabled()" openlmis-message="button.add"/>
        </div>
      </div>

      <hr/>

      <div class="non-full-supply-product-list" ng-show="addedFacilityTypeApprovedProducts.length">
        <div class="row-fluid" ng-repeat="facilityTypeApprovedProduct in addedFacilityTypeApprovedProducts">

          <div class="span5">
            <div class="fluid-grid-cell" id="facilityTypeApprovedProductCodeAndName">
              <label id="facilityTypeApprovedProductNameLabel"
                     ng-bind="facilityTypeApprovedProduct.programProduct.product.code+' | '+facilityTypeApprovedProduct.programProduct.product.primaryName"></label>
            </div>
          </div>

          <div class="span2">
            <div class="fluid-grid-cell">
              <input id="facilityTypeApprovedProduct.maxMonthsOfStock{{$index}}" type="text"
                     ng-class="highlightRequiredFieldInModal(nonFullSupplyProduct.quantityRequested)"
                     class="right-justified"
                     name="maxMonthsOfStock{{$index}}"
                     numeric-validator="positiveInteger"
                     ng-required="true" maxlength="8" ng-model="facilityTypeApprovedProduct.maxMonthsOfStock"
                     openlmis-message="placeholder.quantity"/>
                <span class="rnr-form-error" style="display:none;"
                      id="maxMonthsOfStock{{$index}}" openlmis-message="error.number.only">
                </span>
            </div>
          </div>

          <div class="span2">
            <div class="fluid-grid-cell">
              <input id="facilityTypeApprovedProduct.minMonthsOfStock{{$index}}" type="text"
                     ng-class="highlightRequiredFieldInModal(nonFullSupplyProduct.quantityRequested)"
                     class="right-justified"
                     name="minMonthsOfStock{{$index}}"
                     numeric-validator="positiveInteger"
                     ng-required="true" maxlength="8" ng-model="facilityTypeApprovedProduct.minMonthsOfStock"
                     openlmis-message="placeholder.quantity"/>
                <span class="rnr-form-error" style="display:none;"
                      id="minMonthsOfStock{{$index}}" openlmis-message="error.number.only">
                </span>
            </div>
          </div>

          <div class="span2">
            <div class="fluid-grid-cell">
              <input id="facilityTypeApprovedProduct.eop{{$index}}" type="text"
                     ng-class="highlightRequiredFieldInModal(nonFullSupplyProduct.quantityRequested)"
                     class="right-justified"
                     name="eop{{$index}}"
                     numeric-validator="positiveInteger"
                     ng-required="true" maxlength="8" ng-model="facilityTypeApprovedProduct.eop"
                     openlmis-message="placeholder.quantity"/>
                <span class="rnr-form-error" style="display:none;"
                      id="eop{{$index}}" openlmis-message="error.number.only">
                </span>
            </div>
          </div>

          <div class="span1">
            <div class="fluid-grid-cell delete-role">
              <a href="" class="close" value="delete"
                 ng-click="deleteCurrentFacilityTypeApprovedProduct($index)">&times;</a>
            </div>
          </div>

        </div>
      </div>

    </div>
    <div class="alert alert-danger" id="modalErrorMessage" ng-show="modalError" openlmis-message="modalError"></div>

    <div class="modal-footer">
      <input type="button" id="doneNonFullSupply" class="btn btn-primary"
             ng-click="addNonFullSupplyLineItemsToRnr()"
             openlmis-message="button.done"/>

      <input type="button" id="cancelNonFullSupply" class="btn btn-cancel"
             ng-click="$parent.facilityApprovedProductsModal=false;modalError=''"
             openlmis-message="button.cancel"/>
    </div>
  </div>
</div>